# tg-bot-stats

[![npm version](https://img.shields.io/npm/v/tg-bot-stats.svg)](https://www.npmjs.com/package/tg-bot-stats)
[![–õ–∏—Ü–µ–Ω–∑–∏—è: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

**English version**: [README in English](README.md)

–õ—ë–≥–∫–∏–π Node.js –ø–∞–∫–µ—Ç –¥–ª—è —Å–±–æ—Ä–∞ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π —Å –±–æ—Ç–æ–º, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π SQLite –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ Chart.js –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìä –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–∞–∂–∞—Ç–∏–π –∫–Ω–æ–ø–æ–∫ –∏ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞
- üíæ –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ SQLite –±–∞–∑–µ
- üìà –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏ –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
- üïí –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–∞–∂–∞—Ç–∏–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (—á–∞—Å—ã, –¥–Ω–∏, –º–µ—Å—è—Ü—ã)
- üîç –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –Ω–∞–∂–∞—Ç–∏—è—Ö
- üõ†Ô∏è –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è —Å—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
npm install tg-bot-stats
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```javascript
import TgBotStats from 'tg-bot-stats';

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –∫–∞—Å—Ç–æ–º–Ω–æ–π —Å—Ö–µ–º–æ–π
const statsBot = new TgBotStats({
    dbPath: "./src/databases/bot_stats.db",
    defaultSchema: {
        eventId: "TEXT",
        userId: "TEXT",
        username: "TEXT",
        timestamp: "DATETIME",
        additionalData: "TEXT",
    },
});

// –ó–∞–ø–∏—Å—å –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏
await statsBot.recordClick({
  eventId: 'start_button',
  userId: 'user123',
  additionalData: { platform: 'telegram' }
});

// –ó–∞–ø—É—Å–∫ –¥–∞—à–±–æ—Ä–¥–∞
statsBot.startDashboard({
    port: 8888,
});
```

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

### `new TgBotStats(options)`

–°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–±–æ—Ä—â–∏–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `dbPath` (String): –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É SQLite (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: './bot-stats.db')
- `defaultSchema` (Object): –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –±–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞ –¥–ª—è –∫–Ω–æ–ø–æ–∫)

### –ú–µ—Ç–æ–¥—ã

#### `recordClick(data)`
–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∞–∫—Ç –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `data` (Object): –û–±—ä–µ–∫—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –Ω–∞–∂–∞—Ç–∏–∏ (–º–∏–Ω–∏–º—É–º `eventId`)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** Promise, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏

#### `getEventStats(eventId)`
–ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –æ –Ω–∞–∂–∞—Ç–∏—è—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `eventId` (String): –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–Ω–æ–ø–∫–∏

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** Promise —Å –º–∞—Å—Å–∏–≤–æ–º –∑–∞–ø–∏—Å–µ–π –æ –Ω–∞–∂–∞—Ç–∏—è—Ö

#### `getAllStats()`
–ü–æ–ª—É—á–∞–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –≤—Å–µ–º –∫–Ω–æ–ø–∫–∞–º.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** Promise —Å –æ–±—ä–µ–∫—Ç–æ–º —Å–≤–æ–¥–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

#### `getTimeSeriesStats(period)`
–ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –≤—Ä–µ–º–µ–Ω–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `period` (String): 'hour', 'day', 'month' –∏–ª–∏ 'year' (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 'day')

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** Promise —Å –¥–∞–Ω–Ω—ã–º–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤

#### `startDashboard(options)`
–ó–∞–ø—É—Å–∫–∞–µ—Ç –≤–µ–±-—Å–µ—Ä–≤–µ—Ä —Å –¥–∞—à–±–æ—Ä–¥–æ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `port` (Number): –ü–æ—Ä—Ç –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 3000)

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–∞—à–±–æ—Ä–¥–∞

1. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏**:
   - –õ–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –Ω–∞–∂–∞—Ç–∏–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏
   - –°—Ç–æ–ª–±—á–∞—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –Ω–∞–∂–∞—Ç–∏–π

2. **–í—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞**:
   - –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö –ø–æ —á–∞—Å–∞–º, –¥–Ω—è–º, –º–µ—Å—è—Ü–∞–º –∏–ª–∏ –≥–æ–¥–∞–º

3. **–î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä**:
   - –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –≤ –¥–∏–∞–≥—Ä–∞–º–º–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ö–∞—Å—Ç–æ–º–Ω–∞—è —Å—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

–†–∞—Å—à–∏—Ä—å—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Å—Ö–µ–º—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:

```javascript
const statsBot = new TgBotStats({
  defaultSchema: {
    eventId: 'TEXT',
    userId: 'TEXT',
    timestamp: 'DATETIME',
    additionalData: 'TEXT',
    // –í–∞—à–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è:
    chatType: 'TEXT',
    messageLength: 'INTEGER'
  }
});
```

## –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä –¥–ª—è Telegram –±–æ—Ç–∞

```javascript
import TgBotStats from 'tg-bot-stats';
import TelegramBot from 'node-telegram-bot-api';

const statsBot = new TgBotStats();
const bot = new TelegramBot(process.env.TELEGRAM_TOKEN, { polling: true });

bot.onText(/\/start/, async (msg) => {
  await statsBot.recordClick({
    eventId: 'start_command',
    userId: msg.from.id.toString(),
    additionalData: {
      username: msg.from.username,
      language: msg.from.language_code
    }
  });
  
  await bot.sendMessage(msg.chat.id, '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!');
});

// –ó–∞–ø—É—Å–∫ –¥–∞—à–±–æ—Ä–¥–∞
statsBot.startDashboard({ port: 9999 });
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT ¬© Osipov Sergey